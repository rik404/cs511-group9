ARANGO 1:
LET cutoffDate = DATE_SUBTRACT(DATE_ISO8601("1998-12-01"), 90, "day")

LET result = (
    FOR doc IN sample2
        FILTER doc.shipdate <= cutoffDate
        COLLECT AGGREGATE
            sum_qty = SUM(doc.quantity),
            sum_base_price = SUM(doc.extendedPrice),
            sum_disc_price = SUM(doc.extendedPrice * (1 - doc.discount)),
            sum_charge = SUM(doc.extendedPrice * (1 - doc.discount) * (1 + doc.tax)),
            avg_qty = AVG(doc.quantity),
            avg_price = AVG(doc.extendedPrice),
            avg_disc = AVG(doc.discount),
            count_order = COUNT()
    RETURN {
        sum_qty: sum_qty,
        sum_base_price: sum_base_price,
        sum_disc_price: sum_disc_price,
        sum_charge: sum_charge,
        avg_qty: avg_qty,
        avg_price: avg_price,
        avg_disc: avg_disc,
        count_order: count_order
    }
)

RETURN result[0]

ARANGO 2: SKIP


ARANGO 3:
LET cutoff_order_date = DATE_ISO8601("2000-08-29")
LET cutoff_ship_date = DATE_ISO8601("1990-08-29")

FOR doc IN sample2
    FILTER doc.o_orderDate < cutoff_order_date
    FILTER doc.shipDate > cutoff_ship_date
    FILTER doc.c_marketSegment == "HOUSEHOLD"
    COLLECT orderKey = doc.orderKey, o_orderDate = doc.o_orderDate, o_shipPriority = doc.o_shipPriority
    AGGREGATE revenue = SUM(doc.extendedPrice * (1 - doc.discount))
    SORT revenue DESC, o_orderDate ASC
    RETURN { orderKey, revenue, o_orderDate, o_shipPriority }

ARANGO 4:
LET start_date = DATE_ISO8601("1990-01-01")
LET end_date = DATE_ISO8601("1996-08-04")

FOR doc IN sample2
    FILTER doc.o_orderDate >= start_date
    FILTER doc.o_orderDate < end_date
    FILTER doc.commitDate < doc.receiptDate
    COLLECT o_orderPriority = doc.o_orderPriority
    AGGREGATE order_count = COUNT(doc)
    SORT o_orderPriority ASC
    RETURN { o_orderPriority, order_count }

ARANGO 5:
LET start_date = DATE_ISO8601("1990-01-01")
LET end_date = DATE_ISO8601("1999-04-02")

FOR doc IN sample2
    FILTER doc.c_region_name == "AMERICA"
    FILTER doc.customerKey != NULL
    FILTER doc.o_orderDate >= start_date && doc.o_orderDate < end_date
    COLLECT c_nation_name = doc.c_nation_name
    AGGREGATE revenue = SUM(doc.extendedPrice * (1 - doc.discount))
    SORT revenue DESC
    RETURN { c_nation_name, revenue }

ARANGO 6:
LET start_date = DATE_ISO8601("1990-01-01")
LET end_date = DATE_ISO8601("1997-08-09")
LET min_discount = 0.05 - 0.01
LET max_discount = 0.05 + 0.01

FOR doc IN sample2
    FILTER doc.shipDate >= start_date && doc.shipDate < end_date
    FILTER doc.discount >= min_discount && doc.discount <= max_discount
    FILTER doc.quantity < 40
    COLLECT revenue = SUM([doc.extendedPrice * doc.discount])
    RETURN { revenue }